# MAX Bridge

Библиотека MAX Bridge позволяет мини-приложениям корректно взаимодействовать с API MAX и API операционной системы на устройстве пользователя. В этом разделе содержится список объектов и событий MAX Bridge.

## Подключение библиотеки

Добавьте библиотеку `max-web-app.js`:

```html
<script src="https://st.max.ru/js/max-web-app.js"></script>

```

С подключением библиотеки мини-приложение получит доступ к глобальному объекту `window.WebApp` и сценариям для его использования.

## Объекты

### Window.WebApp

Этот глобальный объект связывает мини-приложение с клиентом и позволяет взаимодействовать с MAX, управлять интерфейсом приложения и получать информацию о пользователях. Объект `window.WebApp` создаётся с каждым запуском сервиса, предзагружает данные и не требует отдельной инициализации — его методы и параметры доступны напрямую.

Версия приложения MAX передаётся в стартовых параметрах URL через `WebAppVersion` и доступна в поле `version` объекта `window.WebApp`. Этот параметр не участвует в формировании хеша для валидации — в хеше учитываются только данные из `WebAppData`.

| Поле | Входные параметры | Тип данных | Описание |
| --- | --- | --- | --- |
| **initData** | - | string | Объект со стартовыми параметрами, который, как и WebAppData, применяется для отображения данных о пользователе в UI |
| **initDataUnsafe** | - | WebAppData | Объект со стартовыми параметрами, который не должен использоваться для валидации пользователей |
| **platform** | - | string | Платформа, с которой запущено мини-приложение. Возможные значения: `ios`, `android`, `desktop`, `web` |
| **version** | - | string | Версия приложения MAX. Формат: `<year>.<build_number>.<patch_version>`, например `25.9.16` |
| **onEvent()** | `eventName: string`, `callback: function` | function | Подпишет на событие с использованием callback |
| **offEvent()** | `eventName: string`, `callback: function` | function | Отпишет callback от события |
| **ready()** | - | function | Сообщит MAX, что мини-приложение готово к работе |
| **close()** | - | function | Закроет мини-приложение |
| **requestContact()** | - | function | Запросит телефон у пользователя в нативном диалоговом окне |
| **BackButton** | - | BackButton | Управляет кнопкой Назад в шапке мини-приложения |
| **ScreenCapture** | - | ScreenCapture | Объект для управления возможностью делать скриншоты / записывать экран |
| **HapticFeedback** | - | HapticFeedback | Объект для управления тактильными виброоткликами |
| **enableClosingConfirmation()** | - | function | Включит предупреждение о риске потерять данные при закрытии |
| **disableClosingConfirmation()** | - | function | Выключит предупреждение о риске потерять данные при закрытии |
| **openLink()** | `url: string` | function | Откроет ссылку во внешнем браузере |
| **openMaxLink()** | `url: string` | function | Откроет диплинк вида `https://max.ru/<url>` внутри MAX |
| **shareContent()** | `text: string`, `link: string` | function | Вызовет нативный экран шеринга |
| **shareMaxContent()** | См. описание | function | Откроет экран шеринга внутри MAX (текст, ссылки или медиа через `mid`) |
| **downloadFile()** | `url: string`, `file_name: string` | function | Скачает файл по прямой ссылке |
| **requestScreenMaxBrightness()** | - | function | Установит яркость экрана на максимум на 30 секунд |
| **restoreScreenBrightness()** | - | function | Восстановит яркость экрана до исходной |
| **openCodeReader()** | `fileSelect: boolean` | function | Откроет камеру для считывания QR-кода |

---

### WebAppData

Этот объект содержит данные, которые мини-приложение получает при запуске. Совпадает с `initData`.

| Параметр | Тип данных | Описание |
| --- | --- | --- |
| **query_id** | string | Уникальный идентификатор сессии мини-приложения |
| **auth_date** | int32 | Время получения данных с бэкенда |
| **hash** | string | Хэш для проверки достоверности параметров |
| **start_param** | WebAppStartParam | Объект с дополнительными данными |
| **user** | object | Данные о пользователе (id, first_name, last_name, username, language_code, photo_url) |
| **chat** | Chat | Данные о чате (id, type), из которого открыто приложение |

---

### BackButton

Управляет кнопкой "Назад" в шапке мини-приложения.

| Поле | Тип данных | Описание |
| --- | --- | --- |
| **isVisible** | boolean | Состояние видимости (false по умолчанию) |
| **onClick()** | function | Устанавливает обработчик нажатия |
| **offClick()** | function | Убирает обработчик нажатия |
| **show()** | function | Делает кнопку видимой и активной |
| **hide()** | function | Скрывает кнопку |

---

### ScreenCapture

Управляет возможностью делать скриншоты или записывать экран.

| Поле | Тип данных | Описание |
| --- | --- | --- |
| **isScreenCaptureEnabled** | boolean | Геттер: `true` — запрещено, `false` — разрешено (по умолчанию) |
| **enableScreenCapture()** | function | Включить запрет на скриншоты / запись экрана |
| **disableScreenCapture()** | function | Отключить запрет на скриншоты / запись экрана |

---

### HapticFeedback

Используется для активации тактильной обратной связи (вибрации).

* **impactOccurred(impactStyle)**: Стиль воздействия (`soft`, `light`, `medium`, `heavy`, `rigid`).
* **notificationOccurred(notificationType)**: Тип уведомления (`error`, `success`, `warning`).
* **selectionChanged**: Сообщает об изменении выбора пользователем.

---

### DeviceStorage

Предоставляет доступ к локальному или защищённому хранилищу данных на устройстве.

| Метод | Входные параметры | Тип данных | Описание |
| --- | --- | --- | --- |
| **setItem()** | `key`, `value` | string, string | Сохраняет пару «ключ-значение» |
| **getItem()** | `key` | string | Получает значение по ключу |
| **removeItem()** | `key` | string | Удаляет значение по ключу |
| **clear()** | - | - | Очищает все сохранённые ключи |